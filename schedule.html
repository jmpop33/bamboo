<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹œí—˜ ê³„íší‘œ</title>
    <style>
        body {
            background: #f5f5f5;
            font-family: "Noto Sans KR", sans-serif;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        .top-box {
            width: 80%;
            margin: 0 auto 20px auto;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        table {
            width: 80%;
            margin: auto;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 14px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }

        th {
            background: #4a76ff;
            color: white;
        }

        .editable {
            cursor: pointer;
        }

        .editable:focus {
            outline: 2px solid #4a76ff;
            background: #eef4ff;
        }

        .add-btn {
            margin: 20px auto;
            display: block;
            padding: 10px 20px;
            font-size: 15px;
            background: #4a76ff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .add-btn:hover {
            background: #2f54d1;
        }

        .delete-btn {
            background:#ff4d4d;
            color:white;
            border:none;
            padding:5px 10px;
            border-radius:5px;
            cursor:pointer;
        }

        .delete-btn:hover {
            background:#d63030;
        }
    </style>
</head>

<body>

<h1>ğŸ“š ì‹œí—˜ ê³„íší‘œ</h1>

<div class="top-box">
    <label>ì‹œí—˜ ë‚ ì§œ ì„ íƒ: </label>
    <input type="date" id="examDate" onchange="updateDDay()">
    <div class="dday" id="ddayText">ì‹œí—˜ ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
</div>

<table id="planTable">
    <tr>
        <th>ìš”ì¼</th>
        <th>ê³¼ëª©</th>
        <th>ê³µë¶€ ë‚´ìš©</th>
        <th>ì™„ë£Œ</th>
        <th>ì‚­ì œ</th>
    </tr>
</table>

<button class="add-btn" onclick="addRow()">+ ê³¼ëª© ì¶”ê°€í•˜ê¸°</button>

<script>

function updateDDay() {
    const dateInput = document.getElementById("examDate").value;
    const ddayText = document.getElementById("ddayText");
    if (!dateInput) return;

    const today = new Date();
    const exam = new Date(dateInput);
    const diff = Math.ceil((exam - today) / (1000 * 60 * 60 * 24));

    ddayText.innerHTML = `ğŸ“Œ D-${diff}`;
}

function addRow() {
    const table = document.getElementById("planTable");
    const rowCount = table.rows.length;
    const id = rowCount;

    const row = table.insertRow(-1);
    row.innerHTML = `
        <td class="editable" contenteditable="true" id="day${id}">ìš”ì¼ ì…ë ¥</td>
        <td class="editable" contenteditable="true" id="subject${id}">ê³¼ëª© ì…ë ¥</td>
        <td class="editable" contenteditable="true" id="study${id}">ê³µë¶€ ë‚´ìš© ì…ë ¥</td>
        <td><input type="checkbox" id="check${id}" onchange="saveCheck(this)"></td>
        <td><button class="delete-btn" onclick="deleteRow(this)">ì‚­ì œ</button></td>
    `;

    attachEditableListener();
    saveTableStructure(); 
}

function deleteRow(btn) {
    const row = btn.parentNode.parentNode;
    const table = document.getElementById("planTable");

    row.querySelectorAll(".editable, input[type='checkbox']").forEach(el => {
        if (el.id) localStorage.removeItem(el.id);
    });

    table.deleteRow(row.rowIndex);
    saveTableStructure();
}

function saveCheck(box) {
    localStorage.setItem(box.id, box.checked);
}

function loadChecks() {
    const boxes = document.querySelectorAll("input[type='checkbox']");
    boxes.forEach(box => {
        if (localStorage.getItem(box.id) === "true") {
            box.checked = true;
        }
    });
}

function saveStudyContents() {
    const items = document.querySelectorAll(".editable");
    items.forEach(item => {
        localStorage.setItem(item.id, item.innerText);
    });
}

function loadStudyContents() {
    const items = document.querySelectorAll(".editable");
    items.forEach(item => {
        const saved = localStorage.getItem(item.id);
        if (saved) item.innerText = saved;
    });
}

function saveTableStructure() {
    const table = document.getElementById("planTable").innerHTML;
    localStorage.setItem("tableHTML", table);
}

function loadTableStructure() {
    const saved = localStorage.getItem("tableHTML");
    if (saved) {
        document.getElementById("planTable").innerHTML = saved;
    }
}

function attachEditableListener() {
    document.querySelectorAll(".editable").forEach(el => {
        el.addEventListener("input", () => {
            saveStudyContents();
            saveTableStructure();
        });
    });
}

window.onload = function() {
    loadTableStructure();
    loadStudyContents();
    loadChecks();
    attachEditableListener();
};

   

</script>
    <button onclick="location.href='timer.html'">íƒ€ì´ë¨¸ë¡œ ëŒì•„ê°€ê¸°</button>
    <button onclick="location.href='main.html'">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
</body>
</html>
